#!/usr/bin/env python
import sys

from mininet.log import setLogLevel, info
from mn_wifi.cli import CLI
from mn_wifi.net import Mininet_wifi

def topology(args):

    net = Mininet_wifi()

    info("*** Creating nodes\n")
    h1 = net.addHost( 'h1', mac='00:00:00:00:00:01', ip='10.0.0.1/8' )
    sta1 = net.addStation( 'sta1', mac='00:00:00:00:00:02', ip='10.0.0.2/8', range='20' )
    sta2 = net.addStation( 'sta2', mac='00:00:00:00:00:03', ip='10.0.0.3/8', range='20' )
    sta3 = net.addStation( 'sta3', mac='00:00:00:00:00:04', ip='10.0.0.4/8', range='20' )
    sta4 = net.addStation( 'sta4', mac='00:00:00:00:00:05', ip='10.0.0.5/8', range='20' )
    sta5 = net.addStation( 'sta5', mac='00:00:00:00:00:06', ip='10.0.0.6/8', range='20' )
    sta6 = net.addStation( 'sta6', mac='00:00:00:00:00:07', ip='10.0.0.7/8', range='20' )
    sta7 = net.addStation( 'sta7', mac='00:00:00:00:00:08', ip='10.0.0.8/8', range='20' )
    sta8 = net.addStation( 'sta8', mac='00:00:00:00:00:09', ip='10.0.0.9/8', range='20' )
    sta9 = net.addStation( 'sta9', mac='00:00:00:00:00:10', ip='10.0.0.10/8', range='20' )
    sta10 = net.addStation( 'sta10', mac='00:00:00:00:00:11', ip='10.0.0.11/8', range='20' )
    sta11 = net.addStation( 'sta11', mac='00:00:00:00:00:02', ip='10.0.0.12/8', range='20' )
    sta12 = net.addStation( 'sta12', mac='00:00:00:00:00:03', ip='10.0.0.13/8', range='20' )
    sta13 = net.addStation( 'sta13', mac='00:00:00:00:00:04', ip='10.0.0.14/8', range='20' )
    sta14 = net.addStation( 'sta14', mac='00:00:00:00:00:05', ip='10.0.0.15/8', range='20' )
    sta15 = net.addStation( 'sta15', mac='00:00:00:00:00:06', ip='10.0.0.16/8', range='20' )
    sta16 = net.addStation( 'sta16', mac='00:00:00:00:00:07', ip='10.0.0.17/8', range='20' )
    sta17 = net.addStation( 'sta17', mac='00:00:00:00:00:08', ip='10.0.0.18/8', range='20' )
    sta18 = net.addStation( 'sta18', mac='00:00:00:00:00:09', ip='10.0.0.19/8', range='20' )
    sta19 = net.addStation( 'sta19', mac='00:00:00:00:00:10', ip='10.0.0.20/8', range='20' )
    sta20 = net.addStation( 'sta20', mac='00:00:00:00:00:11', ip='10.0.0.21/8', range='20' )
    sta21 = net.addStation( 'sta11', mac='00:00:00:00:00:02', ip='10.0.0.22/8', range='20' )
    sta22 = net.addStation( 'sta22', mac='00:00:00:00:00:03', ip='10.0.0.23/8', range='20' )
    sta23 = net.addStation( 'sta23', mac='00:00:00:00:00:04', ip='10.0.0.24/8', range='20' )
    sta24 = net.addStation( 'sta24', mac='00:00:00:00:00:05', ip='10.0.0.25/8', range='20' )
    sta25 = net.addStation( 'sta25', mac='00:00:00:00:00:06', ip='10.0.0.26/8', range='20' )
    sta26 = net.addStation( 'sta26', mac='00:00:00:00:00:07', ip='10.0.0.27/8', range='20' )
    sta27 = net.addStation( 'sta27', mac='00:00:00:00:00:08', ip='10.0.0.28/8', range='20' )
    sta28 = net.addStation( 'sta28', mac='00:00:00:00:00:09', ip='10.0.0.29/8', range='20' )
    sta29 = net.addStation( 'sta29', mac='00:00:00:00:00:10', ip='10.0.0.30/8', range='20' )
    sta30 = net.addStation( 'sta30', mac='00:00:00:00:00:11', ip='10.0.0.31/8', range='20' )
    sta31 = net.addStation( 'sta31', mac='00:00:00:00:00:02', ip='10.0.0.32/8', range='20' )
    sta32 = net.addStation( 'sta32', mac='00:00:00:00:00:03', ip='10.0.0.33/8', range='20' )
    sta33 = net.addStation( 'sta33', mac='00:00:00:00:00:04', ip='10.0.0.34/8', range='20' )
    sta34 = net.addStation( 'sta34', mac='00:00:00:00:00:05', ip='10.0.0.35/8', range='20' )
    sta35 = net.addStation( 'sta35', mac='00:00:00:00:00:06', ip='10.0.0.36/8', range='20' )
    sta36 = net.addStation( 'sta36', mac='00:00:00:00:00:07', ip='10.0.0.37/8', range='20' )
    sta37 = net.addStation( 'sta37', mac='00:00:00:00:00:08', ip='10.0.0.38/8', range='20' )
    sta38 = net.addStation( 'sta38', mac='00:00:00:00:00:09', ip='10.0.0.39/8', range='20' )
    sta39 = net.addStation( 'sta39', mac='00:00:00:00:00:10', ip='10.0.0.40/8', range='20' )
    sta40 = net.addStation( 'sta40', mac='00:00:00:00:00:11', ip='10.0.0.41/8', range='20' )
    sta41 = net.addStation( 'sta41', mac='00:00:00:00:00:02', ip='10.0.0.42/8', range='20' )
    sta42 = net.addStation( 'sta42', mac='00:00:00:00:00:03', ip='10.0.0.43/8', range='20' )
    sta43 = net.addStation( 'sta43', mac='00:00:00:00:00:04', ip='10.0.0.44/8', range='20' )
    sta44 = net.addStation( 'sta44', mac='00:00:00:00:00:05', ip='10.0.0.45/8', range='20' )
    sta45 = net.addStation( 'sta45', mac='00:00:00:00:00:06', ip='10.0.0.46/8', range='20' )
    sta46 = net.addStation( 'sta46', mac='00:00:00:00:00:07', ip='10.0.0.47/8', range='20' )
    sta47 = net.addStation( 'sta47', mac='00:00:00:00:00:08', ip='10.0.0.48/8', range='20' )
    sta48 = net.addStation( 'sta48', mac='00:00:00:00:00:09', ip='10.0.0.49/8', range='20' )
    sta49 = net.addStation( 'sta49', mac='00:00:00:00:00:10', ip='10.0.0.50/8', range='20' )
    sta50 = net.addStation( 'sta50', mac='00:00:00:00:00:11', ip='10.0.0.51/8', range='20' )
    ap1 = net.addAccessPoint( 'ap1', ssid= 'ap1-ssid', mode= 'g', channel= '1', position='30,50,0', range='30' )
    ap2 = net.addAccessPoint( 'ap2', ssid= 'ap2-ssid', mode= 'g', channel= '1', position='80,120,0', range='30' )
    ap3 = net.addAccessPoint( 'ap3', ssid= 'ap3-ssid', mode= 'g', channel= '1', position='130,50,0', range='30' )
    c1 = net.addController( 'c1' )

    info("*** Configuring propagation model\n")
    net.setPropagationModel(model="logDistance", exp=4.5)

    info("*** Configuring wifi nodes\n")
    net.configureWifiNodes()

    info("*** Associating and Creating links\n")
    net.addLink(ap1, h1)
    net.addLink(ap1, ap2)
    net.addLink(ap2, ap3)
    net.addLink(ap1, ap3)

    if '-p' not in args:
        net.plotGraph(max_x=160, max_y=160)

    net.startMobility(time=0, ac_method='ssf')
    net.mobility(sta1, 'start', time=20, position='1,50,0')
    net.mobility(sta1, 'stop', time=79, position='159,50,0')
    net.mobility(sta2, 'start', time=20, position='3,110,0')
    net.mobility(sta2, 'stop', time=79, position='159,80,0')
    net.mobility(sta3, 'start', time=20, position='5,40,0')
    net.mobility(sta3, 'stop', time=79, position='159,20,0')
    net.mobility(sta4, 'start', time=20, position='9,30,0')
    net.mobility(sta4, 'stop', time=79, position='159,50,0')
    net.mobility(sta5, 'start', time=20, position='12,20,0')
    net.mobility(sta5, 'stop', time=79, position='159,80,0')
    net.mobility(sta6, 'start', time=20, position='15,10,0')
    net.mobility(sta6, 'stop', time=79, position='159,60,0')
    net.mobility(sta7, 'start', time=20, position='18,40,0')
    net.mobility(sta7, 'stop', time=79, position='159,70,0')
    net.mobility(sta8, 'start', time=20, position='21,50,0')
    net.mobility(sta8, 'stop', time=79, position='159,80,0')
    net.mobility(sta9, 'start', time=20, position='24,110,0')
    net.mobility(sta9, 'stop', time=79, position='159,90,0')
    net.mobility(sta10, 'start', time=20, position='25,40,0')
    net.mobility(sta10, 'stop', time=79, position='159,100,0')
    net.mobility(sta11, 'start', time=20, position='80,50,0')
    net.mobility(sta11, 'stop', time=79, position='159,50,0')
    net.mobility(sta12, 'start', time=20, position='85,110,0')
    net.mobility(sta12, 'stop', time=79, position='159,80,0')
    net.mobility(sta13, 'start', time=20, position='90,40,0')
    net.mobility(sta13, 'stop', time=79, position='159,20,0')
    net.mobility(sta14, 'start', time=20, position='95,30,0')
    net.mobility(sta14, 'stop', time=79, position='159,50,0')
    net.mobility(sta15, 'start', time=20, position='100,20,0')
    net.mobility(sta15, 'stop', time=79, position='159,80,0')
    net.mobility(sta16, 'start', time=20, position='105,10,0')
    net.mobility(sta16, 'stop', time=79, position='159,60,0')
    net.mobility(sta17, 'start', time=20, position='110,40,0')
    net.mobility(sta17, 'stop', time=79, position='159,70,0')
    net.mobility(sta18, 'start', time=20, position='120,50,0')
    net.mobility(sta18, 'stop', time=79, position='159,80,0')
    net.mobility(sta19, 'start', time=20, position='125,110,0')
    net.mobility(sta19, 'stop', time=79, position='159,90,0')
    net.mobility(sta20, 'start', time=20, position='140,40,0')
    net.mobility(sta20, 'stop', time=79, position='159,100,0')
    net.mobility(sta21, 'start', time=20, position='1,50,0')
    net.mobility(sta21, 'stop', time=79, position='159,50,0')
    net.mobility(sta22, 'start', time=20, position='3,110,0')
    net.mobility(sta22, 'stop', time=79, position='159,80,0')
    net.mobility(sta23, 'start', time=20, position='5,40,0')
    net.mobility(sta23, 'stop', time=79, position='159,20,0')
    net.mobility(sta24, 'start', time=20, position='9,30,0')
    net.mobility(sta24, 'stop', time=79, position='159,50,0')
    net.mobility(sta25, 'start', time=20, position='12,20,0')
    net.mobility(sta25, 'stop', time=79, position='159,80,0')
    net.mobility(sta26, 'start', time=20, position='15,10,0')
    net.mobility(sta26, 'stop', time=79, position='159,60,0')
    net.mobility(sta27, 'start', time=20, position='18,40,0')
    net.mobility(sta27, 'stop', time=79, position='159,70,0')
    net.mobility(sta28, 'start', time=20, position='21,50,0')
    net.mobility(sta28, 'stop', time=79, position='159,80,0')
    net.mobility(sta29, 'start', time=20, position='24,110,0')
    net.mobility(sta29, 'stop', time=79, position='159,90,0')
    net.mobility(sta30, 'start', time=20, position='25,40,0')
    net.mobility(sta30, 'stop', time=79, position='159,100,0')
    net.mobility(sta31, 'start', time=20, position='80,50,0')
    net.mobility(sta31, 'stop', time=79, position='159,50,0')
    net.mobility(sta32, 'start', time=20, position='85,110,0')
    net.mobility(sta32, 'stop', time=79, position='159,80,0')
    net.mobility(sta33, 'start', time=20, position='90,40,0')
    net.mobility(sta33, 'stop', time=79, position='159,20,0')
    net.mobility(sta34, 'start', time=20, position='95,30,0')
    net.mobility(sta34, 'stop', time=79, position='159,50,0')
    net.mobility(sta35, 'start', time=20, position='100,20,0')
    net.mobility(sta35, 'stop', time=79, position='159,80,0')
    net.mobility(sta36, 'start', time=20, position='105,10,0')
    net.mobility(sta36, 'stop', time=79, position='159,60,0')
    net.mobility(sta37, 'start', time=20, position='110,40,0')
    net.mobility(sta37, 'stop', time=79, position='159,70,0')
    net.mobility(sta38, 'start', time=20, position='120,50,0')
    net.mobility(sta38, 'stop', time=79, position='159,80,0')
    net.mobility(sta39, 'start', time=20, position='125,110,0')
    net.mobility(sta39, 'stop', time=79, position='159,90,0')
    net.mobility(sta40, 'start', time=20, position='140,40,0')
    net.mobility(sta40, 'stop', time=79, position='159,100,0')
    net.mobility(sta41, 'start', time=20, position='160,20,0')
    net.mobility(sta41, 'stop', time=79, position='159,50,0')
    net.mobility(sta42, 'start', time=20, position='160,110,0')
    net.mobility(sta42, 'stop', time=79, position='159,60,0')
    net.mobility(sta43, 'start', time=20, position='160,105,0')
    net.mobility(sta43, 'stop', time=79, position='159,20,0')
    net.mobility(sta44, 'start', time=20, position='160,80,0')
    net.mobility(sta44, 'stop', time=79, position='159,50,0')
    net.mobility(sta45, 'start', time=20, position='160,70,0')
    net.mobility(sta45, 'stop', time=79, position='160,80,0')
    net.mobility(sta46, 'start', time=20, position='15,50,0')
    net.mobility(sta46, 'stop', time=79, position='160,60,0')
    net.mobility(sta47, 'start', time=20, position='18,60,0')
    net.mobility(sta47, 'stop', time=79, position='160,70,0')
    net.mobility(sta48, 'start', time=20, position='21,35,0')
    net.mobility(sta48, 'stop', time=79, position='160,80,0')
    net.mobility(sta49, 'start', time=20, position='160,80,0')
    net.mobility(sta49, 'stop', time=79, position='159,90,0')
    net.mobility(sta50, 'start', time=20, position='160,90,0')
    net.mobility(sta50, 'stop', time=79, position='159,100,0')
    net.stopMobility(time=80)

    info("*** Starting network\n")
    net.build()
    c1.start()
    ap1.start([c1])
    ap2.start([c1])
    ap3.start([c1])

    info("*** Running CLI\n")
    CLI( net )

    info("*** Stopping network\n")
    net.stop()

if __name__ == '__main__':
    setLogLevel( 'info' )
    topology(sys.argv)
